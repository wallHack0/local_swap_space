{% extends 'base.html' %}

{% block title %}Your Matches{% endblock %}

{% block content %}
<!-- Display flash messages if there are any -->
    {% if messages %}
        <div class="messages">
            {% for message in messages %}
            <div class="{{ message.tags }}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
    {% endif %}

    <h1>Your Matches</h1>
    <ul>
        <!-- Loop through each match and display details -->
        {% for group in matches %}
        <li>
            <!-- Link to other user's profile -->
            Match with <strong><a href="{% url 'other-user-profile' username=group.other_user.username %}">{{ group.other_user.username }}</a></strong>
            <!-- Link to chat with the other user -->
            <a href="{% url 'chat_detail' group.chat.pk %}">Go to chat</a>
            <ul>
                <!-- List items liked by the user -->
                <li>Items liked by me:
                    <ul>
                        {% for item in group.items_from_user %}
                        <li>
                            {% if item.images.first %}
                            <a href="{% url 'item-detail' pk=item.pk %}">
                                <img src="{{ item.images.first.image.url }}" alt="Image of {{ item.name }}" style="width: 100px; height: auto;">
                            </a>
                            {% endif %}
                            <a href="{% url 'item-detail' pk=item.pk %}">{{ item.name }}</a>
                        </li>
                        {% endfor %}
                    </ul>
                </li>
                <!-- List items liked by the other user -->
                <li>Items liked by {{ group.other_user.username }}:
                    <ul>
                        {% for item in group.items_from_them %}
                        <li>
                            {% if item.images.first %}
                            <a href="{% url 'item-detail' pk=item.pk %}">
                                <img src="{{ item.images.first.image.url }}" alt="Image of {{ item.name }}" style="width: 100px; height: auto;">
                            </a>
                            {% endif %}
                            <a href="{% url 'item-detail' pk=item.pk %}">{{ item.name }}</a>
                        </li>
                        {% endfor %}
                    </ul>
                </li>
            </ul>
            <!-- Form to delete a chat, with confirmation prompt -->
            <form action="{% url 'delete_chat' chat_id=group.chat.pk %}" method="post" onsubmit="return confirmDelete();">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger">Delete Chat</button>
            </form>
        </li>
        {% empty %}
        <p>No matches yet.</p>
        {% endfor %}
    </ul>
    
    <script type="text/javascript">
    function confirmDelete() {
        return confirm('Are you sure you want to delete this chat and all related data? This action cannot be undone.');
    }
    </script>

{% endblock %}
